<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Viagens</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Define a fonte Inter como padrão */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        /* Layout para centralizar o card de login */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Estilo do card de login */
        .login-card {
            max-width: 450px;
            width: 100%;
            border: none;
            border-radius: 1rem; /* Cantos arredondados */
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
        }
        
        /* Cabeçalho do card */
        .login-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        /* Ícone principal */
        .login-header .icon {
            font-size: 3.5rem;
            /* Cor primária (azul) do Bootstrap */
            color: var(--bs-primary);
            margin-bottom: 1rem;
        }
        
        .login-header h2 {
            font-weight: 700;
        }
        
        .login-header p {
            font-size: 1.1rem;
            color: #6c757d; /* text-muted */
        }
        
        /* Botão de login */
        .btn-login {
            padding: 0.75rem;
            font-weight: 600;
            font-size: 1rem;
        }
        
        /* Inputs com ícones flutuantes */
        .form-floating-icon {
            position: relative;
        }
        
        .form-floating-icon .form-control {
            padding-left: 3rem; /* Espaço para o ícone */
        }
        
        .form-floating-icon .form-floating-label {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            padding: 1rem .75rem;
            pointer-events: none;
            left: 2.25rem; /* Alinha o label com o texto */
            z-index: 2;
        }
        
        .form-floating-icon .icon-prefix {
            position: absolute;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            color: #adb5bd;
            z-index: 2;
        }
        
    </style>
</head>
<body>

    <div class="container login-container">
        <div class="card login-card">
            <div class="card-body p-4 p-md-5">
                
                <div class="login-header">
                    <i class="bi bi-car-front-fill icon"></i>
                    <h2>Secretaria da Mulher</h2>
                    <p>Sistema de Viagens</p>
                </div>
                
                <form id="login-form" method="POST">
                    
                    <div class="form-floating mb-3 form-floating-icon">
                        <input type="text" class="form-control" id="usuario" placeholder="Seu usuário" required>
                        <label for="usuario" class="form-floating-label">Usuário</label>
                        <i class="bi bi-person icon-prefix"></i>
                    </div>

                    <div class="form-floating mb-3 form-floating-icon">
                        <input type="password" class="form-control" id="senha" placeholder="Sua senha" required>
                        <label for="senha" class="form-floating-label">Senha</label>
                        <i class="bi bi-lock icon-prefix"></i>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="lembrarMe">
                            <label class="form-check-label" for="lembrarMe">
                                Lembrar-me
                            </label>
                        </div>
                        <a href="#" class="small text-decoration-none">Esqueceu a senha?</a>
                    </div>
                    
                    <div id="error-message" class="alert alert-danger" style="display: none;"></div>

                    <div class="d-grid">
                        <button class="btn btn-primary btn-lg btn-login" type="submit" id="login-button">
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                            <span class="button-text">Entrar</span>
                        </button>
                    </div>
                    
                </form>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Referências aos elementos do formulário
            const loginForm = document.getElementById("login-form");
            const usuarioInput = document.getElementById("usuario");
            const senhaInput = document.getElementById("senha");
            const loginButton = document.getElementById("login-button");
            const spinner = loginButton.querySelector(".spinner-border");
            const buttonText = loginButton.querySelector(".button-text");
            const errorMessageDiv = document.getElementById("error-message");

            // Adiciona um "escutador" para o evento de submit do formulário
            loginForm.addEventListener("submit", function(event) {
                // 1. Impede o envio padrão do formulário (que recarrega a página)
                event.preventDefault();
                
                // 2. Coleta os dados dos campos
                const nome = usuarioInput.value;
                const senha = senhaInput.value;

                // 3. Mostra o feedback de "carregando" no botão
                setLoading(true);

                // 4. Envia os dados como JSON para a rota /auth usando fetch
                fetch('/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Converte os dados do JS para uma string JSON
                    body: JSON.stringify({
                        "nome": nome,
                        "senha": senha
                    })
                })
                .then(response => response.json()) // Converte a resposta do servidor para JSON
                .then(data => {
                    // 5. Processa a resposta do servidor
                    setLoading(false); // Esconde o "carregando"
                    
                    if (data.success) {
                        // SUCESSO! Redireciona para a página /home
                        window.location.href = '/home';
                    } else {
                        // FALHA! Mostra a mensagem de erro
                        showError(data.message || "Erro desconhecido.");
                    }
                })
                .catch(error => {
                    // Trata erros de rede (ex: servidor offline)
                    setLoading(false);
                    showError("Não foi possível conectar ao servidor. Tente novamente.");
                    console.error('Erro na requisição:', error);
                });
            });

            // Função para controlar o estado de "carregando" do botão
            function setLoading(isLoading) {
                if (isLoading) {
                    loginButton.disabled = true;
                    spinner.style.display = "inline-block";
                    buttonText.textContent = "Validando...";
                    errorMessageDiv.style.display = "none"; // Esconde erros antigos
                } else {
                    loginButton.disabled = false;
                    spinner.style.display = "none";
                    buttonText.textContent = "Entrar";
                }
            }

            // Função para exibir a mensagem de erro
            function showError(message) {
                errorMessageDiv.textContent = message;
                errorMessageDiv.style.display = "block";
            }
        });
    </script>
</body>
</html>